(()=>{"use strict";class t{constructor(){}moveDown(){this.coordinates=this.coordinates.map((t=>{const{row:e}=t;return{...t,row:e+1}}))}moveRight(){this.coordinates=this.coordinates.map((t=>{const{column:e}=t;return{...t,column:e+1}}))}moveLeft(){this.coordinates=this.coordinates.map((t=>{const{column:e}=t;return{...t,column:e-1}}))}validMoveRight(t){return this.coordinates.filter((t=>t.side.includes("right"))).every((e=>{const{row:o,column:i}=e,r=i+1;if(r<=9)return"black"===t[o][r]}))}validMoveLeft(t){return this.coordinates.filter((t=>t.side.includes("left"))).every((e=>{const{row:o,column:i}=e,r=i-1;if(r>=0)return"black"===t[o][r]}))}validMoveDown(t){return 0!==this.coordinates.length&&this.coordinates.filter((t=>t.side.includes("bottom"))).every((e=>{const{row:o,column:i}=e,r=o+1;if(r<=19)return"black"===t[r][i]}))}clearCoordinates(t){this.coordinates=this.coordinates.filter((e=>{const{row:o}=e;return!t.includes(o)}))}determineCoordinatesToClear(t){return this.coordinates.filter((e=>{const{row:o}=e;return t.includes(o)}))}}class e extends t{constructor(){super(),this.coordinates=[{row:0,column:4,side:["top","left"]},{row:0,column:5,side:["top","right"]},{row:1,column:4,side:["bottom","left"]},{row:1,column:5,side:["bottom","right"]}],this.color="yellow"}rotateRight(){}rotateLeft(){}}class o extends t{constructor(){super(),this.coordinates=[{row:0,column:3,side:["top","bottom","left"]},{row:0,column:4,side:["top","bottom"]},{row:0,column:5,side:["top","bottom"]},{row:0,column:6,side:["top","bottom","right"]}],this.anchorPointDirection="left",this.color="orange",this.nextRotationRightMove={left:"top",top:"right",right:"bottom",bottom:"left"},this.nextRotationRightMoveMethod={left:this.calcRotationLeftToTop.bind(this),top:this.calcRotationTopToRight.bind(this),right:this.calcRotationRightToBottom.bind(this),bottom:this.calcRotationBottomToLeft.bind(this)},this.nextRotationLeftMove={left:"bottom",bottom:"right",right:"top",top:"left"},this.nextRotationLeftMoveMethod={left:this.calcRotationLeftToBottom.bind(this),bottom:this.calcRotationBottomToRight.bind(this),right:this.calcRotationRightToTop.bind(this),top:this.calcRotationTopToLeft.bind(this)}}rotateLeft(){this.validRotateLeft()&&(this.coordinates=this.nextRotationLeftMoveMethod[this.anchorPointDirection](),this.anchorPointDirection=this.nextRotationLeftMove[this.anchorPointDirection])}validRotateLeft(){return this.nextRotationLeftMoveMethod[this.anchorPointDirection]().every((t=>{const{row:e,column:o}=t;return e>=0&&e<=19&&o>=0&&o<=9}))}calcRotationLeftToBottom(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({column:o,row:e-i,side:t.side.map((t=>this.nextRotationLeftMove[t]))})))}calcRotationBottomToRight(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({row:e,column:o-i,side:t.side.map((t=>this.nextRotationLeftMove[t]))})))}calcRotationRightToTop(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({column:o,row:e+i,side:t.side.map((t=>this.nextRotationLeftMove[t]))})))}calcRotationTopToLeft(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({row:e,column:o+i,side:t.side.map((t=>this.nextRotationLeftMove[t]))})))}rotateRight(){this.validRotateRight()&&(this.coordinates=this.nextRotationRightMoveMethod[this.anchorPointDirection](),this.anchorPointDirection=this.nextRotationRightMove[this.anchorPointDirection])}validRotateRight(){return this.nextRotationRightMoveMethod[this.anchorPointDirection]().every((t=>{const{row:e,column:o}=t;return e>=0&&e<=19&&o>=0&&o<=9}))}calcRotationLeftToTop(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({column:o,row:e+i,side:t.side.map((t=>this.nextRotationRightMove[t]))})))}calcRotationTopToRight(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({row:e,column:o-i,side:t.side.map((t=>this.nextRotationRightMove[t]))})))}calcRotationRightToBottom(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({column:o,row:e-i,side:t.side.map((t=>this.nextRotationRightMove[t]))})))}calcRotationBottomToLeft(){const t=this.coordinates[0],{row:e,column:o}=t;return this.coordinates.map(((t,i)=>({row:e,column:o+i,side:t.side.map((t=>this.nextRotationRightMove[t]))})))}}class i extends t{constructor(){super()}}class r{constructor(t){const r=[];for(let t=0;t<20;t++){const t=[];for(let e=0;e<10;e++)t.push("black");r.push(t)}this.document=document,this.gamePaused=!1,this.gameBoard=r,this.currentPiece=null,this.droppedPieces=[],this.stage=t,this.gameOver=!1,this.currentScore=0,this.interval=setInterval((()=>this.currentPieceDefaultMove()),500),this.allPieces=[new e,new o,new i]}currentPieceDefaultMove(){this.isCurrentPieceStuck()&&this.checkGameOver(),this.isCurrentPieceStuck()&&this.gameOver&&this.restartGame(document),this.isCurrentPieceStuck()||this.gameOver?this.handleCurrentPieceStuck():(this.clearOldTetrominoPosition(),this.currentPiece.moveDown(),this.updateGrid(),this.render())}pauseGame(){this.gamePaused?(this.interval=setInterval((()=>this.currentPieceDefaultMove()),500),this.gamePaused=!1):(clearInterval(this.interval),this.gamePaused=!0)}render(){this.stage.removeAllChildren(),this.gameBoard.forEach(((t,e)=>{t.forEach(((t,o)=>{const i=new createjs.Shape;i.graphics.beginFill(t).drawRect(30*o,30*e,30,30),this.stage.addChild(i)}))})),this.stage.update()}updateGrid(){this.currentPiece.coordinates.forEach((t=>{const{row:e,column:o}=t;this.gameBoard[e][o]=this.currentPiece.color}))}startGame(){this.createNewPiece()}isCurrentPieceStuck(){return!this.currentPiece.validMoveDown(this.gameBoard)}createNewPiece(){const t=new o;this.currentPiece=t,this.droppedPieces.push(t)}calculateCompletedRows(){const t=[];return this.gameBoard.forEach(((e,o)=>{e.every((t=>"black"!==t))&&t.push(o)})),t}calculateScore(){const t=this.calculateCompletedRows().length,e=t<4?100*t:200*t;this.currentScore+=e}clearGameBoardRows(t){this.droppedPieces.forEach((e=>{const o=e.determineCoordinatesToClear(t);for(e.clearCoordinates(t),o.forEach((t=>{const{row:e,column:o}=t;this.gameBoard[e][o]="black"}));e.validMoveDown(this.gameBoard);)e.coordinates.forEach((t=>{const{row:e,column:o}=t;this.gameBoard[e][o]="black"})),e.moveDown(),e.coordinates.forEach((t=>{const{row:o,column:i}=t;this.gameBoard[o][i]=e.color}))})),this.render()}clearOldTetrominoPosition(){this.currentPiece.coordinates.forEach((t=>{const{row:e,column:o}=t;this.gameBoard[e][o]="black"}))}checkGameOver(){const t=this.currentPiece.coordinates.filter((t=>t.side.includes("top")));for(let e=0;e<t.length;e++){const o=t[e],{row:i}=o;if(0===i){this.gameOver=!0,this.pauseGame();break}}}restartGame(t){if(this.gameOver){this.pauseGame();const e=t.createElement("h1"),o=t.createTextNode("GAME OVER");e.appendChild(o),t.body.appendChild(e);const i=t.createElement("button");return i.innerHTML="RESTART GAME",i.addEventListener("click",(()=>{init(),e.removeChild(o),t.body.removeChild(i)})),void t.body.appendChild(i)}}executeMove(t){39===t.keyCode&&this.currentPiece.validMoveRight(this.gameBoard)?(this.clearOldTetrominoPosition(),this.currentPiece.moveRight()):37===t.keyCode&&this.currentPiece.validMoveLeft(this.gameBoard)?(this.clearOldTetrominoPosition(),this.currentPiece.moveLeft()):40===t.keyCode&&this.currentPiece.validMoveDown(this.gameBoard)?(this.clearOldTetrominoPosition(),this.currentPiece.moveDown()):38===t.keyCode?(this.clearOldTetrominoPosition(),this.currentPiece.rotateRight()):88===t.keyCode&&(this.clearOldTetrominoPosition(),this.currentPiece.rotateLeft()),this.updateGrid(),this.render()}handleCurrentPieceStuck(){if(!this.isCurrentPieceStuck())return;const t=this.calculateCompletedRows();t.length>0&&(this.calculateScore(),this.clearGameBoardRows(t)),this.checkGameOver(),this.createNewPiece(),this.updateGrid(),setTimeout((()=>{this.render()}),300),console.log(this)}handleKeyPress(t){t.preventDefault(),this.gamePaused||this.executeMove(t)}}let n,s;window.init=()=>{s=new createjs.Stage("tetris"),n=new r(s,document),n.startGame();const t=new createjs.Shape;t.graphics.beginFill("#000000").drawRect(0,0,300,600),s.addChild(t),n.updateGrid(),n.render(),n.calculateScore();const e=document.createElement("h1"),o=document.createTextNode(`Score: ${n.currentScore}`);e.appendChild(o),document.body.appendChild(e);const i=document.createElement("button");i.innerHTML="PAUSE GAME",i.addEventListener("click",(()=>n.pauseGame())),document.body.appendChild(i),n.gameOver&&n.gamePaused||document.addEventListener("keydown",(t=>n.handleKeyPress(t))),console.log(n)},window.onload=init})();