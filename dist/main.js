(()=>{"use strict";class e{constructor(){this.coordinates=[{row:0,column:4,side:["top","left"]},{row:0,column:5,side:["top","right"]},{row:1,column:4,side:["bottom","left"]},{row:1,column:5,side:["bottom","right"]}],this.color="yellow"}moveDown(){this.coordinates=this.coordinates.map((e=>{const{row:t}=e;return{...e,row:t+1}}))}moveRight(){this.coordinates.forEach((e=>{e.column++}))}moveLeft(){this.coordinates.forEach((e=>{e.column--}))}rotateRight(){}rotateLeft(){}validMoveRight(e){return this.coordinates.filter((e=>e.side.includes("right"))).every((t=>{const{row:r,column:o}=t,i=o+1;if(i<=9)return"black"===e[r][i]}))}validMoveLeft(e){return this.coordinates.filter((e=>e.side.includes("left"))).every((t=>{const{row:r,column:o}=t,i=o-1;if(i>=0)return"black"===e[r][i]}))}validMoveDown(e){return 0!==this.coordinates.length&&this.coordinates.filter((e=>e.side.includes("bottom"))).every((t=>{const{row:r,column:o}=t,i=r+1;if(i<=19)return"black"===e[i][o]}))}clearCoordinates(e){this.coordinates=this.coordinates.filter((t=>{const{row:r}=t;return!e.includes(r)}))}determineCoordinatesToClear(e){return this.coordinates.filter((t=>{const{row:r}=t;return e.includes(r)}))}}class t{constructor(e){const t=[];for(let e=0;e<20;e++){const e=[];for(let t=0;t<10;t++)e.push("black");t.push(e)}this.document=document,this.gamePaused=!1,this.gameBoard=t,this.currentPiece=null,this.droppedPieces=[],this.stage=e,this.gameOver=!1,this.currentScore=0,this.interval=setInterval((()=>this.currentPieceDefaultMove()),500)}currentPieceDefaultMove(){this.isCurrentPieceStuck()&&this.checkGameOver(),this.isCurrentPieceStuck()&&this.gameOver&&this.restartGame(document,this.init),this.isCurrentPieceStuck()||this.gameOver?this.handleCurrentPieceStuck():(this.clearOldTetrominoPosition(),this.currentPiece.moveDown(),this.updateGrid(),this.render())}pauseGame(){this.gamePaused?(this.interval=setInterval((()=>this.currentPieceDefaultMove()),500),this.gamePaused=!1):(clearInterval(this.interval),this.gamePaused=!0)}render(){this.stage.removeAllChildren(),this.gameBoard.forEach(((e,t)=>{e.forEach(((e,r)=>{const o=new createjs.Shape;o.graphics.beginFill(e).drawRect(30*r,30*t,30,30),this.stage.addChild(o)}))})),this.stage.update()}updateGrid(){this.currentPiece.coordinates.forEach((e=>{const{row:t,column:r}=e;this.gameBoard[t][r]=this.currentPiece.color}))}startGame(){this.createNewPiece()}isCurrentPieceStuck(){return!this.currentPiece.validMoveDown(this.gameBoard)}createNewPiece(){const t=new e;this.currentPiece=t,this.droppedPieces.push(t)}calculateCompletedRows(){const e=[];return this.gameBoard.forEach(((t,r)=>{t.every((e=>"black"!==e))&&e.push(r)})),e}calculateScore(){const e=this.calculateCompletedRows().length,t=e<4?100*e:200*e;this.currentScore+=t}clearGameBoardRows(e){this.droppedPieces.forEach((t=>{const r=t.determineCoordinatesToClear(e);for(t.clearCoordinates(e),r.forEach((e=>{const{row:t,column:r}=e;this.gameBoard[t][r]="black"}));t.validMoveDown(this.gameBoard);)t.coordinates.forEach((e=>{const{row:t,column:r}=e;this.gameBoard[t][r]="black"})),t.moveDown(),t.coordinates.forEach((e=>{const{row:r,column:o}=e;this.gameBoard[r][o]=t.color}))})),this.render()}clearOldTetrominoPosition(){this.currentPiece.coordinates.forEach((e=>{const{row:t,column:r}=e;this.gameBoard[t][r]="black"}))}checkGameOver(){const e=this.currentPiece.coordinates.filter((e=>e.side.includes("top")));for(let t=0;t<e.length;t++){const r=e[t],{row:o}=r;if(0===o){this.gameOver=!0,this.pauseGame();break}}}restartGame(e,t){if(this.gameOver){this.pauseGame();const r=e.createElement("h1"),o=e.createTextNode("GAME OVER");r.appendChild(o),e.body.appendChild(r);const i=e.createElement("button");return i.innerHTML="RESTART GAME",i.addEventListener("click",(()=>{t(),r.removeChild(o),e.body.removeChild(i)})),void e.body.appendChild(i)}}executeMove(e){39===e.keyCode&&this.currentPiece.validMoveRight(this.gameBoard)?(this.clearOldTetrominoPosition(),this.currentPiece.moveRight()):37===e.keyCode&&this.currentPiece.validMoveLeft(this.gameBoard)?(this.clearOldTetrominoPosition(),this.currentPiece.moveLeft()):40===e.keyCode&&this.currentPiece.validMoveDown(this.gameBoard)&&(this.clearOldTetrominoPosition(),this.currentPiece.moveDown()),this.updateGrid(),this.render()}handleCurrentPieceStuck(){if(!this.isCurrentPieceStuck())return;const e=this.calculateCompletedRows();e.length>0&&(this.calculateScore(),this.clearGameBoardRows(e)),this.checkGameOver(),this.createNewPiece(),this.updateGrid(),setTimeout((()=>{this.render()}),300),console.log(this)}}let r,o;const i=()=>{o=new createjs.Stage("tetris"),r=new t(o,document),r.startGame();const e=new createjs.Shape;e.graphics.beginFill("#000000").drawRect(0,0,300,600),o.addChild(e),r.updateGrid(),r.render(),r.calculateScore();const i=document.createElement("h1"),c=document.createTextNode(`Score: ${r.currentScore}`);i.appendChild(c),document.body.appendChild(i);const s=document.createElement("button");s.innerHTML="PAUSE GAME",s.addEventListener("click",(()=>{r.pauseGame()})),document.body.appendChild(s),console.log(r)};document.addEventListener("keydown",(e=>{e.preventDefault(),r.gameOver&&r.restartGame(document,i),r.executeMove(e)})),window.onload=i})();